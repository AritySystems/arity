@{
    ViewBag.Title = "Order Details";
}
<style>
    .borderless td, .borderless th {
        border: none !important;
    }
</style>
<div class="container">
    <div class="page-header">
        <h1>Order Details</h1>
    </div>
    <input type="hidden" value="@ViewBag.OrderId" id="OrderId" />
    <div class="text-right">
        <a href="/order/adminorders" class="btn btn-primary">  Back</a>
    </div>
    <div class="row">
        <table class="table borderless" style="width:50%">
            <tr>
                <td><h4>Order Name: </h4> @ViewBag.OrderName</td>
                <td><h4>Order Date: </h4>@ViewBag.OrderDate</td>
                <td><h4 class="alert-warning">Status: </h4>@ViewBag.Status</td>
            </tr>


        </table>
        <div class="row">
            <h3>Order Items :</h3>
        </div>
        <div class="row">
            <table class="table" id="tblOrderItemList">
                <thead>
                    <tr>
                        <th></th>
                        <th>Order Name</th>
                        <th>Product Name</th>
                        <th>Purchase Price($)</th>
                        <th>Sales Price($)</th>
                        <th>Purchase Price(Y)</th>
                        <th>Sales Price(Y)</th>
                        <th>Qunatity</th>
                        <th>Created Date</th>
                        <th>Suppliers</th>
                    </tr>
                </thead>
            </table>
        </div>
        <div class="row text-center">
            <div>
                <button class="btn btn-primary" id="btnSave">Save</button>
                <button class="btn btn-success" id="btnSubmit">Submit</button>
            </div>
        </div>

        <div class="row">
            <h3>Supplier Order Items :</h3>
        </div>
        <div class="row">
            <table class="display" id="tblSupplierOrderItemList">
                <thead>
                    <tr>
                        <th></th>
                        <th>Supplier Name</th>
                        <th>Order Prefix </th>
                        <th>Quantity</th>
                        <th>Status</th>
                        <th>Date</th>
                    </tr>
                </thead>
            </table>
        </div>
    </div>
</div>
@section Scripts {
    
    <script>
        $("#btnSave").click(function () {
            alert("Order Line Item information saved successfully");
        });
        $("#btnSubmit").click(function () {
            var UpdatedQuantity = $('#txtQuantity').val();
            var SupplierId = $('#jsonSupplierList').val();
            $.ajax({
                url: "@Url.Action("AddSupplierOrderLineItems", "Order")",
                method: "POST",
            data: { id: $("#ProductId").val(), qty: $("#ProductQty").val() },
            dataType: "json"
        }).done(function (response) {
            if (response.data != null) {
                $.each(response.data, function (e, data) {
                    if($(".tr_"+data.Id).length <= 0)
                    {
                        $("#lstProducts").append("<tr id='tr_" + window.productCounter + "' class='tr_"+data.Id+"'><td><input type='hidden' name='productId_" + window.productCounter + "' value='" + data.Id + "'/><span class='" + (data.Parent_Id > 0 ? "child-product" : "") + "'> " + data.English_Name + "</span></td><td><input style='text-align:center;' onkeyup='qtyTouched(this);' type='number' value='" + data.Quantity + "' name='qty_" + window.productCounter + "' /></td><td><input type='hidden' value='" + data.Dollar_Price + "' id='spnPrice_" + window.productCounter + "'/>$" + data.Dollar_Price + "</td><td><span id='total_" + window.productCounter + "' class='itemTotal'>$" + (data.Dollar_Price * data.Quantity) + "</span></td><td align='center'><i class='fa fa-remove' style='color:red;cursor:pointer;' onclick='removeItem(" + window.productCounter + ")'></i></td></tr>")
                        window.productCounter = window.productCounter + 1;}
                });
                var OrderTotal = 0;
                $(".itemTotal").each(function () {
                    OrderTotal = OrderTotal + parseInt($(this).text().replace('$', ''));
                });
                $(".order-total").html('$' + OrderTotal);
                $("#lineItem").show();
            }
        }).fail(function (jqXHR, textStatus) {
            console.log("Request failed: " + textStatus);
        });

        });

        $(document).ready(function () {
            var orderid = $('#OrderId').val();
            var table = $('#tblOrderItemList').DataTable({
                "ajax": "/Order/OrderLineItemList?OrderId=" + orderid,
                "columns": [
                    {
                        "data": "Id",
                        "orderable": false,
                        "render": function (data, type, full) {
                            return '<input type="hidden" id="txtId" value="' + data + '"/>'
                        }
                    },
                    { "data": "Order_Name" },
                    { "data": "Product_Name" },
                    { "data": "Purchase_Price_dollar" },
                    { "data": "Sales_Price_dollar" },
                    { "data": "Purchase_Price_rmb" },
                    { "data": "Sales_Price_rmb" },
                    {
                        "data": "quantity",
                        "render": function (data, type, full) {
                            return '<input type="text" id="txtQuantity" value="' + data + '"/>'
                        }    
                    },
                    {
                        "data": "CreatedDate",
                    },
                    {
                        "data": "Suppliers",
                        "render": function (data, type, row) {
                                ddl = '<select id="jsonSupplierList">';
                                $.each(data, function (i, item) {
                                        ddl += '<option id="' + item.Text + '">' + item.Value + '<option>';
                                });
                                ddl += '</select>';

                            return ddl;
                        }
                    }],
                "orderLineItems": [[1, 'asc']]
            });
            var table = $('#tblSupplierOrderItemList').DataTable({
                "ajax": "/Order/SuppliersOrderLineItemList?OrderId=" + orderid,
                "columns": [
                    {
                        "data": "Id",
                        "ordering": false,
                        "render": function (data, type, full) {
                            return '<input type="hidden" id="txtId" value="' + data + '"/>'
                        }
                    },
                    { "data": "SupplierName" },
                    { "data": "Order_Prefix" },
                    { "data": "Quantity" },
                    { "data": "Status" },
                    {
                        "data": "CreatedDate",
                    },
                ],
                "SupplierOrderLineItems": [[1, 'asc']]
            });

        });
    </script>
}
